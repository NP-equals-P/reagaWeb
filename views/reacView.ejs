<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="/styles/reacViewStyles.css">
        <link rel="icon" href="./pictures/logo.ico" type="image/x-icon">
        <title> Reac View </title>
        <script>
            function onLoadFunction() {
                
                const editButton = document.getElementById("editReactorButton");
                const activateButton = document.getElementById("activateButton");
                const pauseButton = document.getElementById("pauseButton");
                const routineSelect = document.getElementById("routineSelect");

                if (document.getElementById("isReactorActive").value === "true") {

                    editButton.disabled = true;
                    activateButton.innerText = "Disactivate Reactor"
                    pauseButton.disabled = false;
                    routineSelect.disabled = true;

                } else {

                    editButton.disabled = false;
                    activateButton.innerText = "Activate Reactor"
                    pauseButton.disabled = true;
                    routineSelect.disabled = false;
                }

            }

            async function activateReactor() {

                const takenUrl = "http://localhost:3000/api/reactor/activateReactor";
                const reacId = document.getElementById("reacId").value;
                const userId = document.getElementById("_id").value;

                const responseCheck = await fetch(takenUrl, {method: "post", headers: {"Content-Type": "application/json"}, body: JSON.stringify({
                reacId: reacId,
                _id: userId,
                activeRoutine: ""
                })});
            }
        </script>
    </head>
    <body onload="onLoadFunction()">

        <input type="hidden" id="_id" value="<%= user.id %>">
        <input type="hidden" id="reacId" value="<%= reactor._id %>">
        <input type="hidden" id="isReactorActive" value="<%= reactor.isActive %>">
        <input type="hidden" id="isReactorPaused" value="<%= reactor.isPaused %>">

        <%- include('./partials/nav.ejs', {name: user.username, _id: user._id}) %>
        <div class="div1">

            <a href="/api/user/start?_id=<%= user._id %>">
                <button class="backButt">Back</button>
            </a>

            <label class="reactorLabel" for="reactor">Reactor:</label>
            <select class="reactorSelect" name="reactor" id="" disabled>
                <option value="<%= reactor.name %>"><%= reactor.name %></option>
            </select>


            <span class="activeStatus" style="color: red;">(is not active)</span>
            <select name="activeRoutine" id="routineSelect" class="activeRoutineSelect"></select>
            <button class="pauseButt" id="pauseButton">Pause Routine</button>
            <button class="activationButt" id="activateButton" onclick="activateReactor()">Activate Reactor</button>
            <a href="/api/reactor/editReactor?_id=<%= user._id %>&reactorId=<%= reactor._id %>">
                <button class="erButton" id="editReactorButton">Edit Reactor</button>
            </a>

            <button class="hdButton">All Historic Data</button>
            <div class="div2">
            </div>
            <div class="div3">
            </div>

            <button class="ldButton">All Log Data</button>
            <div class="div4">
            </div>
            <div class="div5">
                <% for (let i=0; i<esporadicEvents.length; i+=1) { %>
                    <%- include("./partials/viewEvntButton.ejs", {name: esporadicEvents[i].name, _id: user._id, evntId: esporadicEvents[i]._id, reacId: reactor._id}) %>
                <% } %>
            </div>
        
        </div>
    </body>
</html>